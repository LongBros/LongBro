<!DOCTYPE HTML>
<html>
<head>
<title>哆啦日记-不仅仅是怀旧</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="../../image/logo/dlam.jpg" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="../lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/style.css" />
<script type="text/javascript" src="js/index.js"></script>
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->

</head>
<style type="text/css">
	body {
		background-color: #e2e2e2;
	}
	.contents{
		width: 55%;
		margin-left: 420px;
		margin-top: 30px;
		background:white ;
	}
	.diarys{
	}
	.diary{
		padding: 10px;
		background-color: white;
		padding-bottom: 5px;
		cursor: pointer;
	}
	.diary img{
		width: 20px;
		height: 24px;
		padding: 1px;
	}
	.info{
		color: gray;
		font-size: 10px;
	}
	.zan{
		float:right;
		margin-right: 15px;
	}
	.rights{
		top: 75px;
		left:38px;
		width:356px;
		position:fixed;
		float: right;
		background:white;
		height: 520px;
	}
	.rights img{
		width: 124px;
		height: 180px;
		padding: 1px;
		margin-left:20px;
		margin-top:20px;
		border-radius:5px;
	}
	.rights .perStatistic{
		padding-left: 20px;
		margin-top: 10px;
		padding-bottom: 10px;
	}
	.rights .perInfo{
		padding-left: 20px;
		margin-top: 10px;
		padding-bottom: 10px;
	}
	.rights .activeInfo{
		padding-left: 20px;
		margin-top: 20px;
	}
	.activeInfo span{
		padding-left: 5px;
	}
	.pages{
		vertical-align: middle;
		text-align: center;
		padding-top: 20px;
		padding-bottom: 20px;
	}
	.pages span{
		width:30px;
		height:30px;
		text-align:center;
		line-height:30px;
		display:inline-block;
		background-color:#e2e2e2; 
	}
</style>
<body>
<header class="navbar-wrapper">
	<div class="navbar navbar-fixed-top">
		<div class="container-fluid cl"> <a class="logo navbar-logo f-l mr-10 hidden-xs" href="/aboutHui.shtml">哆啦日记</a> <a class="logo navbar-logo-m f-l mr-10 visible-xs" href="/aboutHui.shtml">Ying</a> 
			<span class="logo navbar-slogan f-l mr-10 hidden-xs">Doranote</span> 
			<a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
				<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
			<ul class="cl">
				<li>写日记</li>
				<li class="dropDown dropDown_hover">
					<a href="#" class="dropDown_A">admin <i class="Hui-iconfont">&#xe6d5;</i></a>
					<ul class="dropDown-menu menu radius box-shadow">
						<li><a href="javascript:;" onClick="myselfinfo()">我的家园</a></li>
						<li><a href="#">写笔记</a></li>
						<li><a href="#">退出</a></li>
				</ul>
			</li>
				<li id="Hui-msg"> <a href="#" title="消息"><span class="badge badge-danger">1</span><i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i></a> </li>
				<li id="Hui-skin" class="dropDown right dropDown_hover"> <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
					<ul class="dropDown-menu menu radius box-shadow">
						<li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
						<li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
						<li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
						<li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
						<li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
						<li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
					</ul>
				</li>
			</ul>
		</nav>
	</div>
</div>
</header>
<div class="contents">
	<div class="pages" style="cursor: pointer;">
	</div>
	<div class="diarys" id="diarys">
		<div class="diary" >
			我是内容<br>
			LongBro	2019-10-12 23:00:52 星期六 |《我又想你了》  广东省广州市
			<div class="zan">
				<i class="Hui-iconfont">&#xe725;</i>2000&nbsp;
				<i class="Hui-iconfont">&#xe622;</i>66&nbsp;
				<i class="Hui-iconfont">&#xe66d;</i>8
			</div>
		</div>
	</div>
	<div class="pages" style="cursor: pointer;">
	</div>
</div>

<div class="rights">
		<img src='../../image/logo/dlam.jpg' class='touxiang'>
		<button>上传头像<i class="Hui-iconfont">&#xe642;</i></button>
		<button>关注<i class="Hui-iconfont">&#xe716;</i></button>
		<button>已关注<i class="Hui-iconfont">&#xe676;</i></button>
	<div class="perStatistic">
		<span title="她关注的人">关注：88</span>&emsp;<span title="关注她的人">粉丝：99</span>&emsp;
		<span title="她喜欢的日记">喜欢：99</span>&emsp;<span title="她收藏的日记">收藏：99</span><br>	
		<span title="她的日记总被阅读量">被阅读量：888888</span>&emsp;<span title="她的日记总被评论量">被评论数：2222</span>&emsp;<span title="她的日记总被赞数量">被赞：99999</span>
	</div>
	<hr>
	<div class="perInfo">
		<span id="userNameT">LongBro</span><br>
		昵称：<span id="userName">LongBro</span><br>
		哆啦ID：<span id="userId">88888888</span><br>
		家歌：<span id="homeSong">四块五</span><br>
		性别：<span id="sex">男</span><br>
		个性签名：<span id="signature">自先沉稳，而后爱人</span><br>
	</div>
	<hr>
	<div class="activeInfo">
		<i class="Hui-iconfont">&#xe690;</i><span id="joinTime">加入时间：2019.09.28 11:26</span><br>
		<i class="Hui-iconfont">&#xe690;</i><span id="recentLogin">最近登录：2019.09.28 11:26</span><br>
	</div>
</div>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="../static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="../lib/jquery.contextmenu/jquery.contextmenu.r2.js"></script>
<script type="text/javascript">
function GetQueryString(name)
{
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  unescape(r[2]); return null;
}
var curPage=1;
var author=GetQueryString("author");//被查看的用户
//var user=getUser();//当前登录用户
$(function(){
	loadAuthorInfo();
	setPage();
	loadDiaryByAuthor(author,1);
});
/*个人信息*/
function myselfinfo(){
	layer.open({
		type: 1,
		area: ['300px','200px'],
		fix: false, //不固定
		maxmin: true,
		shade:0.4,
		title: '查看信息',
		content: '<div>管理员信息</div>'
	});
}

/*根据作者加载日记*/
function loadDiaryByAuthor(author,page){
	$("#diarys").text("");
	$.ajax({
		url:"../../getDiaryBy.do",
		type:"get",
		async:false,
		dataType:"Json",
		data:{
			author:author,
			page:page
		},
		success:function(data){
			for(var i=0;i<data.length;i++){
				//处理内容和标题
				var title=data[i].ntitle+"";
				var con=handleCon(data[i].ncontent);
				console.log(con);

				if(con.length>50){
					//con=con.substring(0,50)+"...";
				}
				if(title.length>10){
					title=title.substring(0,8)+"...";
				}
				//分类
				var cate=getCateById(data[i].ntype);
				$("#diarys").append("<div class=\"diary\"><span onclick='openOther(0,"+data[i].nid+")'>&emsp;&emsp;"+con+"</span><br>"
						+"<div class='info'>&emsp;<i class=\"Hui-iconfont\">&#xe690;</i>"+data[i].ntime
						+"&emsp;<i class=\"Hui-iconfont\">&#xe681;</i>"+cate+"&nbsp;:<span title='"+data[i].ntitle+"'>《"+title+"》</span>&emsp;<i class=\"Hui-iconfont\">&#xe6c9;</i>"+data[i].nlocation+""
						+"<div class='zan'><i class=\"Hui-iconfont\">&#xe725;</i>2019&nbsp;<i class=\"Hui-iconfont\">&#xe622;</i>188&nbsp;<i class=\"Hui-iconfont\">&#xe66d;</i><span>"+data[i].praiseNum+"</span>&nbsp;<i class=\"Hui-iconfont\">&#xe66e;</i>8&nbsp;<i class=\"Hui-iconfont\">&#xe630;</i><span>"+data[i].storeNum+"</span></div></div>"
						+"</div><hr width='740px'>");
			}
		}
	});
	curPage=parseInt(page);
	setPage();
}
/*打开其他的界面：作者、某日记*/
function openOther(type,value){
	if(type==0){
		window.open("diary.html?id="+value, "_blank")
	}else if(type==1){
		window.open("author.html?author="+value, "_blank")
	}
}
/*根据分类id得到分类名*/
function getCateById(id){
	var cate="0";
	if(id=="0"){
		cate="生活日记";
	}else if(id=="1"){
		cate="工作笔记";
	}else if(id=="2"){
		cate="idea";
	}else if(id=="3"){
		cate="诗词(文学)";
	}
	return cate;
}
/*处理日记内容*/
function handleCon(content){
	var reg=/<[^<>]+>/g ;
	//var reg1=/<(?!img).*?>/g;//保留img标签
	//var reg2=/<\/?((?!img).)*?\/?>/g;
	//var reg3=/<(?!img|p|/p).*?>/g;//保留img、p标签
	var con=content+"";
	con=con.replace(reg, "");
	con=con.replace(new RegExp("::::","gm"), ".jpg'>");
	con=con.replace(new RegExp(":::","gm"), ".png'>");
	con=con.replace(new RegExp("::","gm"), ".gif'>");
	con=con.replace(new RegExp("<<<","gm"), "<img alt='' src='../../image/expre/newtieba/");
	con=con.replace(new RegExp("<<","gm"), "<img alt='' src='../../image/expre/tieba/");
	con=con.replace(new RegExp("&&&&","gm"), "<img alt='' src='../../image/expre/weibo/");
	con=con.replace(new RegExp("&&&","gm"), "<img alt='' src='../../image/expre/huang/");
	con=con.replace(new RegExp("&&","gm"),"<img alt='' src='../../image/expre/aodamiao/");
	
	return con;
}
/*根据日记数量初始化页码按钮*/
function setPage(){
	$(".pages").text('');
	var num=0;
	$.ajax({
		url:"../../getDiaryNumBy.do",
		type:"get",
		async:false,
		data:{
			NWritter:author
		},
		dataType:"text",
		success:function(data){
			num=data;
		}
	});
	var page=0;
	if(num%10==0){//可整除的话，页码数为总日记数除以10
		page=num/10;
	}else{//不可整除的话，页码数为总日记数除以10加1
		page=parseInt(num/10)+1;
	}
	$(".pages").append("共"+num+"篇日记&emsp;");
	if(page>1){//两页及以上方显示页码
		if(curPage!=1){
			$(".pages").append("<span onclick=\"loadDiaryByAuthor('"+author+"','1')\">首</span>&emsp;")
			$(".pages").append("<span onclick=\"loadDiaryByAuthor('"+author+"','"+(curPage-1)+"')\">←</span>&emsp;");
		}
		if(page>6){//多于6页，只显示6页
			
		}else{
			for(var i=1;i<=page;i++){
				if(curPage==i){
					$(".pages").append("<span onclick=\"loadDiaryByAuthor('"+author+"','"+i+"')\" style=\"color:white;background:black;\">"+i+"</span>&emsp;")
				}else{
					$(".pages").append("<span onclick=\"loadDiaryByAuthor('"+author+"','"+i+"')\">"+i+"</span>&emsp;")
				}
			}
		}
		if(curPage+1<=page){//＜＞
			$(".pages").append("<span onclick=\"loadDiaryByAuthor('"+author+"','"+(curPage+1)+"')\">→</span>&emsp;")
			$(".pages").append("<span onclick=\"loadDiaryByAuthor('"+author+"','"+page+"')\">尾</span>&emsp;")
		}
	}
	
}
//2019-10-26加载作者的信息:关注信息，互动计数，基本信息，活跃信息
function loadAuthorInfo(){
	$.ajax({
		url:"../../getAuthorInfoByUserId.do?UUserId="+author,
		type:"get",
		async:false,
		dataType:"Json",
		success:function(data){
			document.title=data.uuserName+"的日记~哆啦官网";
			document.getElementById("userId").innerText=author;
			document.getElementById("userNameT").innerText=data.uuserName;
			document.getElementById("userName").innerText=data.uuserName;
			document.getElementById("homeSong").innerText=data.uhomeSong;
			document.getElementById("signature").innerText=data.signature;
			document.getElementById("sex").innerText=data.uuserSex;
			document.getElementById("joinTime").innerText="加入时间："+data.ujoinTime;
		}
	});
}
</script> 
</body>
</html>