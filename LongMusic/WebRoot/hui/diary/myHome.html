<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="../../image/logo/dlam.jpg" />
<script type="text/javascript" src="js/index.js"></script>
<link rel="stylesheet" type="text/css" href="../../css/index1.css">

<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="../static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="../lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/style.css" />
<script type="text/javascript" src="../../js/jquery.js"></script>
<script type="text/javascript" src="js/index.js"></script><!-- 获取当前登录用户 -->
<script type="text/javascript" src="js/index1.js"></script><!-- 处理日记 -->

<script type="text/javascript" src="../../js/myjs/timeDeal.js"></script><!-- 时间处理函数 -->
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>我的家园-哆啦日记</title>
<meta name="keywords" content="">
<meta name="description" content="">
</head>
<style type="text/css">
	body {
		background-color: #e2e2e2;
	}
	.contents{
		width: 880px;
		margin-left: 420px;
		background:white ;
		margin-top: 30px;
	}
	.tabs span{
		margin-left:30px;
		cursor: pointer;
	}
	.diary{
		width: 800px;
		margin-left: 10px;
		margin-top: 10px;
		cursor: pointer;
	}
	.diary img{
		width: 20px;
		height: 24px;
		padding: 1px;
	}
	.info{
		color: gray;
		font-size: 10px;
	}
	.zan{
		float:right;
		margin-right: 15px;
	}
	.rights{
		top: 75px;
		left:38px;
		width:356px;
		position:fixed;
		float: right;
		background:white;
		height: 520px;
	}
	.rights img{
		width: 124px;
		height: 180px;
		padding: 1px;
		margin-left:20px;
		margin-top:20px;
		border-radius:5px;
	}
	.rights .perStatistic{
		padding-left: 20px;
		margin-top: 10px;
		padding-bottom: 10px;
	}
	.rights .perInfo{
		padding-left: 20px;
		margin-top: 10px;
		padding-bottom: 10px;
	}
	.rights .activeInfo{
		padding-left: 20px;
		margin-top: 20px;
	}
	.praiseAStore{
		text-align: center;
		margin-top: 20px;
	}
	.pages{
		vertical-align: middle;
		text-align: center;
		padding-top: 20px;
		padding-bottom: 20px;
	}
	.pages span{
		width:30px;
		height:30px;
		text-align:center;
		line-height:30px;
		display:inline-block;
		background-color:#e2e2e2; 
	}
</style>
<body>
<header class="navbar-wrapper">
	<div class="navbar navbar-fixed-top">
		<div class="container-fluid cl"> <a class="logo navbar-logo f-l mr-10 hidden-xs" href="/aboutHui.shtml">哆啦日记</a> <a class="logo navbar-logo-m f-l mr-10 visible-xs" href="/aboutHui.shtml">Ying</a> 
			<span class="logo navbar-slogan f-l mr-10 hidden-xs">Doranote</span> 
			<a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
				<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
			<ul class="cl">
				<li id="homepage" style="cursor:pointer;" onclick="openNewPage('1')">首页</li>
				<li class="dropDown dropDown_hover">
					<a href="#" class="dropDown_A"><span id="image">admin</span> <i class="Hui-iconfont">&#xe6d5;</i></a>
					<ul class="dropDown-menu menu radius box-shadow">
						<li><a href="javascript:;" id="myHome" style="display:none" onClick="openNewPage('2')">我的家园</a></li>
						<li><a href="javascript:;" id="write" style="display:none" onClick="openNewPage('3')">写日记</a></li>
						<li><a href="javascript:;" id="alarm" style="display:none" onClick="openNewPage('4')">哆啦闹铃</a></li>
						<li><a href="javascript:;" id="exit" style="display:none" onClick="openNewPage('6')">退出</a></li>
						<li><a class="login" id="login" style="display:block">登录</a></li>
					</ul>
			</li>
				<li id="Hui-msg" class="dropDown right dropDown_hover"> <a href="#" title="消息"><span class="badge badge-danger" id="unReadNum"></span><i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i></a> 
					<ul class="dropDown-menu menu radius box-shadow">
						<li><a href="javascript:;" data-val="red" title="公告数目">公告<font color="red"><span id="advNum"></span></font></a></li>
						<li><a href="javascript:;" data-val="default" title="评论数目">评论<font color="red"><span id="comNum"></span></font></a></li>
						<li><a href="javascript:;" data-val="blue" title="获赞数目">获赞<font color="red"><span id="praiseNum"></span></font></a></li>
						<li><a href="javascript:;" data-val="green" title="关注数目">关注<font color="red"><span id="noticeNum"></span></font></a></li>
						<li><a href="javascript:;" data-val="yellow" title="点击后消息标记为已读" id="cleanBtn" style="display:none" onclick="setAsReaded()">朕已阅✔</a></li>
						<li><a href="javascript:;" data-val="yellow" title="消息设置">设置</a></li>
					</ul>
				</li>
				<li id="Hui-skin" class="dropDown right dropDown_hover"> <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
					<ul class="dropDown-menu menu radius box-shadow">
						<li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
						<li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
						<li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
						<li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
						<li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
						<li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
					</ul>
				</li>
			</ul>
		</nav>
	</div>
</div>
</header>


<div class="modal fade" id="loginModal" style="display:none;">
			<div class="modal-dialog modal-sm" style="width:540px;">
				<div class="modal-content" style="border:none;">
					<div class="col-left"></div>
					<div class="col-right">
						<div class="modal-header">
							<button type="button" id="login_close" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
							<h4 class="modal-title" id="loginModalLabel" style="font-size: 18px;">登录</h4>
						</div>
						<div class="modal-body">
							<section class="box-login v5-input-txt" id="box-login">
								<form id="login_form" name="login_form" action="" method="post" autocomplete="off">
									
									<ul>
										<li class="form-group"><input class="form-control" id="id_account_l" maxlength="50" name="account_l" placeholder="请输入邮箱账号/手机号" type="text"></li>
										<li class="form-group"><input class="form-control" id="id_password_l" name="password_l" placeholder="请输入密码" type="password"></li>
									</ul>
								</form>
								<p class="good-tips marginB10"><a id="btnForgetpsw" class="fr">忘记密码？</a>还没有账号？<a href="javascript:;" target="_blank" id="btnRegister">立即注册</a></p>
								<div class="login-box marginB10">
									<button id="login_btn" type="button" onclick="login()" class="btn btn-micv5 btn-block globalLogin">登录</button>
									<div id="login-form-tips" class="tips-error bg-danger" style="display: none;">错误提示</div>
								</div>
<!-- 								<div class="threeLogin"><span>其他方式登录</span><a class="nqq" href="javascript:;"></a><a class="nwx" href="javascript:;"></a><a class="nwb"></a></div>
 -->							</section>
						</div>
					</div>
				</div>
			</div>
			
		</div>


<div class="contents">
	<div class="tabs">
		&emsp;&emsp;<span onclick="loadMyDiary()" id="my">我的日记</span>
		&emsp;&emsp;<span onclick="loadMyLove()" id="love">我的喜欢</span>
		&emsp;<span onclick="loadMyStore()" id="store">我的收藏</span>
		&emsp;<span>我看过的</span>	
	</div>
	<div id="myDiary"></div>
	<div class="pages" style="cursor: pointer;">
	</div>
</div>
<div class="rights">
		<img src='../../image/logo/dlam.jpg' class='touxiang'>
		<!-- 自己的账号显示上传头像按钮，别人的根据有没有关注而显示 -->
		<button>上传头像<i class="Hui-iconfont">&#xe642;</i></button>
	<div class="perStatistic">
		关注：<span title="朕关注的人" id="careNum">0</span>&emsp;粉丝：<span title="关注朕的人" id="noticedNum">0</span>&emsp;
		喜欢：<span title="朕喜欢的日记" id="likeNum">0</span>&emsp;收藏：<span title="朕收藏的日记" id="storeNum">0</span><br>	
		被阅读量：<span title="朕的日记总被阅读量" id="visitedNum">0</span>&emsp;阅读量：<span title="朕的阅读量" id="visitNum">0</span>&emsp;被评论数：<span title="朕的日记总被评论量" id="comedNum">0</span>
		&emsp;被赞：<span title="她的日记总被赞数量" id="praisedNum">0</span>
	</div>
	<hr>
	<div class="perInfo">
		<span id="userNameT">LongBro</span><br>
		昵称：<span id="userName">LongBro</span><br>
		哆啦ID：<span id="userId">66666666</span><br>
		家歌：<span id="homeSong">四块五</span><br>
		性别：<span id="sex">男</span><br>
		个性签名：<span id="signature">自先沉稳，而后爱人</span><br>
	</div>
	<hr>
	<div class="activeInfo">
		<i class="Hui-iconfont">&#xe690;</i><span id="joinTime">加入时间：2019.09.28 11:26</span><br>
		<i class="Hui-iconfont">&#xe690;</i><span id="recentLogin">最近登录：2019.09.28 11:26</span><br>
	</div>
</div>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="../static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="../lib/jquery.contextmenu/jquery.contextmenu.r2.js"></script>
<script type="text/javascript">
var user=getCookie("userId")+"";//当前登录用户
getUser();
$(".login").on("click", login_popup),function() {
    var e = [];
    $(".modal").on("show.bs.modal",
    function() {
        for (var s = 0; e.length > s; s++) e[s] && (e[s].modal("hide"), e[s] = null);
        e.push($(this));
        var o = $(this),
        a = o.find(".modal-dialog"),
        t = $('<div style="display:table; width:100%; height:100%;"></div>');
        t.html('<div style="vertical-align:middle; display:table-cell;"></div>'),
        t.children("div").html(a),
        o.html(t)
    })
} ();
var author=user;//loadAuthorInfo()函数中需要author

$(function(){
	//判断当前登录人是否已点赞、收藏该日记，并对图标做修改
	loadAuthorInfo();//index.js中
	var curPage=1;//当前页码
	var perPage=10;//当前一页展示日记数量
	loadMyDiary(author,curPage,perPage);

	setPage1(author,perPage);
});
function setPage1(author,perPage){
	$(".pages").text('');
	var num=0;
	$.ajax({
		url:"../../note/diary/getDiaryNumBy.do",
		type:"get",
		async:false,
		data:{
			NWritter:author
		},
		dataType:"text",
		success:function(data){
			num=data;
		}
	});
	var page=0;
	if(num%perPage==0){//可整除的话，页码数为总日记数除以10
		page=num/perPage;
	}else{//不可整除的话，页码数为总日记数除以10加1
		page=parseInt(num/perPage)+1;
	}
	var value=new Array("10","20","30","40");
	var sel="<select onchange='setPer1(options[selectedIndex].value)'>";
	for(var i=0;i<value.length;i++){
		if(value[i]==perPage){
			sel=sel+"<option value='"+value[i]+"' selected>每页"+value[i]+"篇</option>";
		}else{
			sel=sel+"<option value='"+value[i]+"'>每页"+value[i]+"篇</option>";
		}
	}
	sel=sel+"</select>";
	if(num>10){
		$(".pages").append(sel+"&nbsp;共"+num+"篇日记&nbsp;"+curPage+"/"+page+"&emsp;");
	}else{//只有10篇无需显示选择每页多少篇
		$(".pages").append("&nbsp;共"+num+"篇日记&nbsp;");
	}
	if(curPage!=1){
		$(".pages").append("<span onclick=\"loadMyDiary('"+author+"','1','"+perPage+"')\">首</span>&emsp;")
		$(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+(curPage-1)+"','"+perPage+"')\">←</span>&emsp;");
	}
	if(page>5){//多于5页，只显示5页
		if(curPage>page-5){//当前页码大于总页码-5，输出后六页
			for(var i=page-4;i<=page;i++){
	              if(i==curPage){
	  				   $(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+i+"','"+perPage+"')\" style=\"color:white;background:black;\">"+i+"</span>&emsp;")
		          }else{
					   $(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+i+"','"+perPage+"')\">"+i+"</span>&emsp;")
	         	  }
	        }
		}else{//当前页码小于总页码-6，输出当前页码后的六页
            for(var i=curPage;i<curPage+5;i++){
                if(i==curPage){
	  				   $(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+i+"','"+perPage+"')\" style=\"color:white;background:black;\">"+i+"</span>&emsp;")
                }else{
					   $(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+i+"','"+perPage+"')\">"+i+"</span>&emsp;")
                }
            }
         }
		
	}else{//少于5页，显示所有页码
		if(page!=1){//只有一页无需显示页码
			for(var i=1;i<=page;i++){
				if(curPage==i){
					$(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+i+"','"+perPage+"')\" style=\"color:white;background:black;\">"+i+"</span>&emsp;")
				}else{
					$(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+i+"','"+perPage+"')\">"+i+"</span>&emsp;")
				}
			}
		}
	}
	if(curPage+1<=page){//＜＞
		$(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+(curPage+1)+"','"+perPage+"')\">→</span>&emsp;")
		$(".pages").append("<span onclick=\"loadMyDiary('"+author+"','"+page+"','"+perPage+"')\">尾</span>&emsp;")
	}
	
}
function setPer1(pernum){
	perPage=pernum;
	setPage1(author,perPage);
	loadMyDiary(author,curPage,perPage);
}
//加载我的日记
function loadMyDiary(user,page,perPage){
	$("#myDiary").text('');
	if(user==""){
		alert("请登录");
		return;
	}
	document.getElementById("my").style.color="red";
	document.getElementById("love").style.color="black";
	document.getElementById("store").style.color="black";
	var au="0,1,2";//完全公开的
	//$("#myDiary").text("");
	$.ajax({
		url:"../../note/diary/getDiaryBy.do",
		type:"get",
		async:false,
		dataType:"Json",
		data:{
			author:user,
			page:page,
			authority:au,
			perPage:perPage
		},
		success:function(data){
			if(data.length<1){
				$("#myDiary").append("<br><br><center>你还没有写过日记呢，快去写一篇吧！</center><br><br>");
				return;
			}
			for(var i=0;i<data.length;i++){
				//处理内容和标题
				var title=data[i].ntitle+"";
				var con=handleCon(data[i].ncontent);
				if(con.length>250){
					con=con.substring(0,250)+"......";
				}
				if(title.length>10){
					//title=title.substring(0,8)+"...";
				}
				var mood=getMoodById(data[i].nmood);
				var wea=getWeaById(data[i].nweather);
				//分类
				var cate=getCateById(data[i].ntype);
				$("#myDiary").append("<div class=\"diary\"><span onclick='openOther(0,"+data[i].nid+")'>"+con+"</span><br>"
						+"<div class='info'>"
						+"</span>&emsp;<i class=\"Hui-iconfont\">&#xe690;</i>"+data[i].ntime+"&emsp;&emsp;心情："+mood+"&emsp;&emsp;天气："+wea
						+"&emsp;<i class=\"Hui-iconfont\">&#xe681;</i>"+cate+"&nbsp;:<span title='"+data[i].ntitle+"'>《"+title+"》</span>&emsp;"
						+"<div class='zan'><i class=\"Hui-iconfont\">&#xe725;</i>"+data[i].visitNum
						+"&nbsp;<i class=\"Hui-iconfont\">&#xe622;</i><span id='commentNum'>"+data[i].commentNum+"</span>&nbsp;<i class=\"Hui-iconfont\">&#xe66d;</i><span>"+data[i].praiseNum
						+"</span>&nbsp;<i class=\"Hui-iconfont\">&#xe630;</i><span>"+data[i].storeNum
						+"</span>&nbsp;<span style='color:red' onclick='editDiary("+data[i].nid+")'>编辑</span></div></div>"
						+"</div><hr width='800px'>");
			}

		}
	});
	curPage=parseInt(page);
	perPage=parseInt(perPage);
	setPage1(user,perPage);
}
//加载我喜欢的
function loadMyLove(){
	$("#myDiary").text('');
	if(user==""){
		alert("请登录");
		return;
	}
	document.getElementById("my").style.color="black";
	document.getElementById("love").style.color="red";
	document.getElementById("store").style.color="black";
	$.ajax({
		url:"../../note/praise/getMyLikeDiary.do?userId="+user,
		type:"get",
		async:false,
		dataType:"Json",
		success:function(data){
			var res=data.result;
			if(res.length<1){
				$("#myDiary").append("<br><br><center>你还没有喜欢的日记喔！</center><br><br>");
				return;
			}
			for(var i=0;i<res.length;i++){
				var con=handleCon(res[i].content);
				var title=res[i].title+"";
				if(con.length>250){
					con=con.substring(0,250)+"......";
				}
				if(title.length>10){
					title=title.substring(0,8)+"...";
				}
				$("#myDiary").append("<div class=\"diary\" title='"+res[i].likeTime+"喜欢'><img src='../../image/tx/"+res[i].headImg+".jpg' class='touxiang'><span onclick='openOther(0,"+res[i].id+")'>"+con+"</span><br>"
						+"<div class='info'><i class=\"Hui-iconfont\">&#xe60d;</i><span style='cursor:pointer' onclick='openOther(1,\""+res[i].writter+"\")'>"+res[i].u_User_Name
						+"</span>&emsp;<i class=\"Hui-iconfont\">&#xe690;</i>"+res[i].time
						+"&emsp;<i class=\"Hui-iconfont\">&#xe681;</i>"+res[i].cate+"&nbsp;:<span title='"+res[i].title+"'>《"+title+"》</span>&emsp;<i class=\"Hui-iconfont\">&#xe6c9;</i>"+res[i].loc
						+"<div class='zan'><i class=\"Hui-iconfont\">&#xe725;</i>"+res[i].visitNum+"&nbsp;<i class=\"Hui-iconfont\">&#xe622;</i><span id='commentNum'>"+res[i].commentNum+"</span>&nbsp;<i class=\"Hui-iconfont\">&#xe66d;</i><span>"+res[i].praiseNum
						+"</span>&nbsp;<i class=\"Hui-iconfont\">&#xe630;</i><span>"+res[i].storeNum+"</span></div></div>"
						+"</div><hr width='740px'>");
			}
			$("#myDiary").append("<br><br><center>朕共喜欢<font color='red'>"+res.length+"</font>篇日记</center><br>");

		}
	});
}
//加载我收藏的
function loadMyStore(){
	$("#myDiary").text('');
	if(user==""){
		alert("请登录");
		return;
	}
	document.getElementById("my").style.color="black";
	document.getElementById("love").style.color="black";
	document.getElementById("store").style.color="red";
	$.ajax({
		url:"../../note/store/getMyStoreDiary.do?userId="+user,
		type:"get",
		async:false,
		dataType:"Json",
		success:function(data){
			var res=data.result;
			if(res.length<1){
				$("#myDiary").append("<br><br><center>你还没有收藏过日记喔！</center><br><br>");
				return;
			}
			for(var i=0;i<res.length;i++){
				var con=handleCon(res[i].content);
				var title=res[i].title+"";
				if(con.length>250){
					con=con.substring(0,250)+"......";
				}
				if(title.length>10){
					title=title.substring(0,8)+"...";
				}
				$("#myDiary").append("<div class=\"diary\" title='"+res[i].likeTime+"收藏'><img src='../../image/tx/"+res[i].headImg+".jpg' class='touxiang'><span onclick='openOther(0,"+res[i].id+")'>"+con+"</span><br>"
						+"<div class='info'><i class=\"Hui-iconfont\">&#xe60d;</i><span style='cursor:pointer' onclick='openOther(1,\""+res[i].writter+"\")'>"+res[i].u_User_Name
						+"</span>&emsp;<i class=\"Hui-iconfont\">&#xe690;</i>"+res[i].time
						+"&emsp;<i class=\"Hui-iconfont\">&#xe681;</i>"+res[i].cate+"&nbsp;:<span title='"+res[i].title+"'>《"+title+"》</span>&emsp;<i class=\"Hui-iconfont\">&#xe6c9;</i>"+res[i].loc
						+"<div class='zan'><i class=\"Hui-iconfont\">&#xe725;</i>"+res[i].visitNum+"&nbsp;<i class=\"Hui-iconfont\">&#xe622;</i><span id='commentNum'>"+res[i].commentNum+"</span>&nbsp;<i class=\"Hui-iconfont\">&#xe66d;</i><span>"+res[i].praiseNum
						+"</span>&nbsp;&nbsp;<i class=\"Hui-iconfont\">&#xe630;</i><span>"+res[i].storeNum+"</span></div></div>"
						+"</div><hr width='740px'>");
			}
			$("#myDiary").append("<br><br><center>朕共收藏了<font color='red'>"+res.length+"</font>篇日记</center><br>");

		}
	});
}
//加载我看过的
function loadMyFeet(){
	
}
//编辑日记
function editDiary(id){
	//window.location="new.html?id="+id;
	window.open("new.html?id="+id,"_blank");
}
</script> 
</body>
</html>